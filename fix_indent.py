with open("app/views/auth.py", "r") as f: lines = f.readlines(); fixed_lines = []; i = 0; for line in lines: i += 1; if i >= 200 and i <= 230: if "# 查询用户" in line: fixed_lines.append("        # 查询用户\n"); elif "try:" in line and i == 201: fixed_lines.append("        try:\n"); elif "user = User.query.filter_by" in line: fixed_lines.append("            user = User.query.filter_by(username=username).first()\n"); elif "current_app.logger.info" in line and "查询用户结果" in line: fixed_lines.append("            current_app.logger.info(f\"查询用户结果: {user is not None}\")\n"); elif "# 检查用户是否存在" in line: fixed_lines.append("            # 检查用户是否存在\n"); elif "if user is None:" in line: fixed_lines.append("            if user is None:\n"); elif "用户不存在" in line: fixed_lines.append("                current_app.logger.info(f\"用户不存在: {username}\")\n"); elif "flash" in line and "用户名或密码错误" in line and i < 215: fixed_lines.append("                flash(\"用户名或密码错误\", \"danger\")\n"); elif "return render_template" in line and i < 215: fixed_lines.append("                return render_template(\"auth/login.html\", form=form, title=\"登录\")\n"); elif "# 检查用户是否被禁用" in line: fixed_lines.append("            # 检查用户是否被禁用\n"); elif "if not user.is_active:" in line: fixed_lines.append("            if not user.is_active:\n"); elif "用户已被禁用" in line: fixed_lines.append("                current_app.logger.info(f\"用户已被禁用: {username}\")\n"); elif "flash" in line and "账户已被禁用" in line: fixed_lines.append("                flash(\"账户已被禁用\", \"danger\")\n"); elif "return render_template" in line and i < 220 and i > 215: fixed_lines.append("                return render_template(\"auth/login.html\", form=form, title=\"登录\")\n"); elif "# 检查密码是否正确" in line: fixed_lines.append("            # 检查密码是否正确\n"); elif "try:" in line and i > 215: fixed_lines.append("            try:\n"); elif "开始验证密码" in line: fixed_lines.append("                current_app.logger.info(f\"开始验证密码: 用户名={username}\")\n"); elif "password_correct = user.verify_password" in line: fixed_lines.append("                password_correct = user.verify_password(password)\n"); elif "密码验证结果" in line: fixed_lines.append("                current_app.logger.info(f\"密码验证结果: {password_correct}\")\n"); elif "if not password_correct:" in line: fixed_lines.append("                if not password_correct:\n"); elif "密码错误" in line: fixed_lines.append("                    current_app.logger.info(f\"密码错误: 用户名={username}\")\n"); elif "flash" in line and "用户名或密码错误" in line and i > 220: fixed_lines.append("                    flash(\"用户名或密码错误\", \"danger\")\n"); elif "return render_template" in line and i > 220: fixed_lines.append("                    return render_template(\"auth/login.html\", form=form, title=\"登录\")\n"); else: fixed_lines.append(line); else: fixed_lines.append(line); with open("app/views/auth.py", "w") as f: f.writelines(fixed_lines)
